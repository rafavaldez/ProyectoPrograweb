
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Puzzle</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/trontastic/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <link href="~/assets/css/sopa-de-letras.css" rel="stylesheet" />
    <style>
        #container {
            width: 1200px;
            border: 2px solid black;
            border-radius: 20px;
            margin: 40px auto;
            padding: 10px;
        }

        #pieceContainer {
            width: 536px;
            height: 536px;
            border: 1px solid black;
            float: left;
            text-align: center;
            font-size: 30px;
            line-height: 400px;
            position: relative;
        }

        #puzzleContainer {
            width: 536px;
            height: 536px;
            border: 1px solid black;
            float: right;
        }

        ul {
            list-style-type: none;
            text-align: center;
        }

            ul button {
                width: 100px;
                border: 1px solid black;
                font-size: 20px;
                border-radius: 5px;
                padding: 5px;
                margin-top: 10px;
            }

        #btnReset {
            display: none;
        }

        .piece {
            width: 65px;
            height: 65px;
            border: 1px solid black;
            float: left;
            background-image: url(../../assets/img/leon.jpg);
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="soup-container">
    <div id="container">
        <div id="pieceContainer"></div>
        <div id="puzzleContainer"></div>
        <ul id="buttons">
            <li><button id="btnStart">Empezar</button></li>
            <li><button id="btnReset">Reiniciar</button></li>
        </ul>
    </div>
</body>
</html>

<script>
    $(document).ready(function () {
        var piezas = createPieces(true);
        $("#puzzleContainer").html(piezas);
        $("#btnStart").click(function () {
            var piezas = $("#puzzleContainer div");
            piezas.each(function () {
                //Es el cambio de la posición de la pieza de manera aleatoria
                var leftPosition =
                    Math.floor(Math.random() * 300 + 0) + "px";
                var topPosition =
                    Math.floor(Math.random() * 300 + 0) + "px";
                $(this).addClass("draggablePiece").css({
                    position: "absolute",
                    left: leftPosition,
                    top: topPosition
                })
                $("#pieceContainer").append($(this));
            });
            var string_vacio = createPieces(false);
            $("#puzzleContainer").html(string_vacio);
            $(this).hide();
            $("#btnReset").show()
            implementLogic()
        });

        $("#btnReset").click(function () {
            var newPieces = createPieces(true);
            $("#puzzleContainer").html(newPieces);
            $(this).hide();
            $("#btnStart").show();
            $("#pieceContainer").empty();

        });

        function createPieces(withImage) {
            var filas = 8,
                columnas = 8;
            var piezas = "";

            for (var i = 0, top = 0, order = 0; i < filas; i++, top -= 70) {
                for (var j = 0, left = 0; j < columnas; j++, left -= 90, order++) {

                    if (withImage) {
                        piezas += "<div style='background-position:" + left + "px " + top + "px;' class='piece' data-order=" +
                            order + "></div>";

                    } else {
                        piezas += "<div style='background-image:none;' class='piece droppableSpace'></div>";
                    }



                }
            }
            return piezas;
        }

        function checkIfPuzzleSolved() {
            if ($("#puzzleContainer .droppedPiece").length != 20) {
                return false;
            }
            for (var k = 0; k < 20; k++) {
                var item = $("#puzzleContainer .droppedPiece:eq(" + k + ")");
                var order = item.data("order");
                if (k == order) {
                    $("#pieceContainer").text("Ouch! Intenta Otra vez");
                    return false;
                }

            }
            $("pieceContainer").text("WoW! Lograste completar el rompecabezas");
            return true;

        }

        function implementLogic() {
            $(".draggablePiece").draggable({
                revert: "invalid",
                start: function () {
                    if ($(this).hasClass("droppedPiece")) {
                        $(this).removeClass("droppedPiece");
                        $(this).parent().removeClass("piecePresent")
                    }
                }
            });
            $(".droppableSpace").droppable({
                hoverClass: "ui-state-highlight",
                accept: function () {
                    return !$(this).hasClass("piecePresent")

                },
                drop: function (event, ui) {
                    var draggableElement = ui.draggable;
                    var droppedOn = $(this);
                    droppedOn.addClass("piecePresent");
                    $(draggableElement)
                        .addClass("droppedPiece")
                        .css({
                            top: 0,
                            left: 0,
                            position: "relative"
                        }).appendTo(droppedOn);
                    checkIfPuzzleSolved();
                }
            });
        }
    });
</script>
